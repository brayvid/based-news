<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <!-- Title set to your preference -->
  <title>Based News | Blake Rayvid</title>

  <!-- Your existing description -->
  <meta name="description" content="A tunable news digest, curated hourly by Google's Gemini AI. Get unbiased, up-to-the-minute headlines on the topics that matter most to you.">
  
  <!-- =================================================================== -->
  <!-- SEO: Core Metadata Additions                                        -->
  <!-- =================================================================== -->
  <!-- The definitive URL for this page -->
  <link rel="canonical" href="https://news.blakerayvid.com" />
  <!-- Optional: Create a favicon and uncomment this line -->
  <!-- <link rel="icon" href="/favicon.ico" sizes="any"> -->

  <!-- =================================================================== -->
  <!-- SEO: Open Graph / Social Sharing Tags (Facebook, LinkedIn, etc.)    -->
  <!-- =================================================================== -->
  <meta property="og:title" content="Based News | Blake Rayvid" />
  <meta property="og:description" content="A tunable news digest, curated hourly by Google's Gemini AI. Get unbiased, up-to-the-minute headlines on the topics that matter most to you." />
  <meta property="og:type" content="website" />
  <meta property="og:url" content="https://news.blakerayvid.com" />
  <meta property="og:site_name" content="Based News" />
  <!-- IMPORTANT: For this to work, create a 1200x630px image named "social-share-image.png" and place it in your site's root directory. -->
  <meta property="og:image" content="https://news.blakerayvid.com/images/example.png" />
  <meta property="og:image:width" content="1200" />
  <meta property="og:image:height" content="630" />

  <!-- =================================================================== -->
  <!-- SEO: Twitter Card Tags                                              -->
  <!-- =================================================================== -->
  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:title" content="Based News | Blake Rayvid" />
  <meta name="twitter:description" content="A tunable news digest, curated hourly by Google's Gemini AI. Get unbiased, up-to-the-minute headlines on the topics that matter most to you." />
  <!-- Twitter uses the same image as Open Graph. -->
  <meta name="twitter:image" content="https://news.blakerayvid.com/images/example.png" />
  
  <!-- =================================================================== -->
  <!-- SEO: Structured Data (JSON-LD) for Richer Search Results            -->
  <!-- =================================================================== -->
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "WebSite",
    "name": "Based News",
    "url": "https://news.blakerayvid.com",
    "description": "A tunable news digest, curated hourly by Google's Gemini AI.",
    "publisher": {
      "@type": "Person",
      "name": "Blake Rayvid"
    }
  }
  </script>

  <!-- Your existing styles and font links are unchanged -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <style>
    body {
  margin: 0;
  font-family: 'Open Sans', sans-serif;
  background-color: #f4f4f4;
  color: #333;
  line-height: 1.6;
}

.container {
  width: 90%;
  max-width: 800px;
  margin: 0 auto;
  padding-top: 4px;
}


header {
  background-color: #1a1a1a;
  color: #fff;
  padding: 1.5em 0;
  text-align: center;
}

header h1 {
  margin: 0;
  font-family: 'Merriweather', serif;
  font-size: 2.5em;
}

.subheading {
  margin-top: 0.5em;
  font-size: 1.1em;
  color: #ccc;
}

main {
  background: #fff;
  box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
  margin-top: 2em;
  padding: 2em 1.6em;
}

/* --- Digest Pagination Styles --- */
.digest-pagination {
  display: flex;
  justify-content: center;
  align-items: center;
  gap: 8px; /* Gap between arrows and dots container */
  margin-bottom: 1em;
  margin-top: 0.8em;
  user-select: none;
}

.arrow-btn {
  background-color: transparent;
  border: none;
  color: #555;
  font-size: 18px;
  cursor: pointer;
  padding: 5px;
  line-height: 1;
  transition: color 0.2s;
}

.arrow-btn:hover:not(:disabled) {
  color: #000;
}

.arrow-btn:disabled {
  opacity: 0.3;
  cursor: not-allowed;
}

#dots-container {
  display: flex;
  align-items: center;
  gap: 12px;
}

.dot {
  width: 10px;
  height: 10px;
  background-color: #ccc;
  border-radius: 50%;
  cursor: pointer;
  transition: background-color 0.2s, transform 0.2s;
  flex-shrink: 0;
}

.dot:hover {
  background-color: #aaa;
}

.dot.active {
  background-color: #003366;
  transform: scale(1.2);
}

.digest-timestamp {
    font-family: 'Merriweather', serif;
    font-size: 1.1em;
    text-align: center;
    color: #444;
    margin-bottom: 1em;
    border-bottom: 1px solid #eee;
    padding-bottom: 0.5em;
}

/* --- Slider Styles --- */
#digest-slider-wrapper {
  overflow: hidden;
  position: relative;
  width: 100%;
  transition: height 0.25s ease-in-out; /* Smooth height transition */
}

#digest-slider {
  display: flex;
  transition: transform 0.4s ease-in-out;
  align-items: flex-start; 
}

.digest-slide {
  width: 100%;
  flex-shrink: 0;
  box-sizing: border-box;
}

/* General Section Styles */
section h3 {
  font-family: 'Merriweather', serif;
  border-bottom: 2px solid #ddd;
  padding-bottom: 0.3em;
  margin-top: 1.5em;
  margin-bottom: 0.5em;
}

section p {
  margin: 0.5em 0 1em 0;
  /* KEY FIX: This will wrap long words/URLs correctly without breaking normal words. */
  word-break: break-word;
}

section a {
  color: #003366;
  text-decoration: none;
  font-weight: 600;
  /* KEY FIX: Applying the same wrapping rule to links. */
  word-break: break-word; 
}

section a:hover {
  text-decoration: underline;
}

footer {
  text-align: center;
  font-size: 0.9em;
  color: #666;
  padding: 2em 0;
}

a {
  color: #003366;
  text-decoration: none;
  font-weight: 600;
  transition: color 0.2s ease, text-decoration 0.2s ease;
}

a:hover,
a:focus {
  color: #d33c2d;
  text-decoration: underline;
}

.summary-heading {
  font-family: 'Merriweather', serif;
  font-size: 1.3em;
  border-bottom: 2px solid #ddd;
  padding-bottom: 0.3em;
  margin-top: 2em;
  margin-bottom: 1em;
}

p.timestamp {
  font-size: 0.85em !important;
  color: #888;
}

@media (max-width: 600px) {
  header h1 { font-size: 1.8em; }
  .subheading { font-size: 0.95em; }
  main { padding: 1em; }
  section h3 { font-size: 1.0em; }
  a { font-size: 0.95em; }
  .digest-timestamp { font-size: 1em; }
  .arrow-btn { font-size: 32px; }
  #dots-container { gap: 10px; }
  .dot { width: 9px; height: 9px; }
}

@media (hover: none) and (pointer: coarse) {
  a:hover,
  a:focus {
    color: #003366;
    text-decoration: none;
  }
}
  </style> 
  <link rel="preload" href="https://fonts.googleapis.com/css2?family=Merriweather:wght@400;700&family=Open+Sans:wght@400;600&display=swap" as="style" onload="this.onload=null;this.rel='stylesheet'">
<noscript><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Merriweather:wght@400;700&family=Open+Sans:wght@400;600&display=swap"></noscript>
</head>
<body>
  <header>
    <div class="container header-bar">
      <div class="title-group">
        <h1>Based News Reader</h1>
        <p class="subheading">Curated with Gemini, updated hourly.</p>
      </div>
      <div class="header-right-placeholder"></div>
    </div>
  </header>

  <main class="container">
    <section id="digest-container">
      <div class="digest-pagination">
        <button id="older-btn" class="arrow-btn" disabled title="Older Digest">◄</button>
        <div id="dots-container"></div>
        <button id="newer-btn" class="arrow-btn" disabled title="Newer Digest">►</button>
      </div>
       <p id="digest-timestamp-header" class="digest-timestamp">Loading...</p>
      <div id="digest-slider-wrapper">
        <div id="digest-slider">
          <!-- Slides will be injected here by JS in reverse chronological order -->
           <div class="digest-slide" id="digest-slide-0">
              <!--LATEST_DIGEST_CONTENT_PLACEHOLDER-->
          </div>
        </div>
      </div>
    </section>

    <section id="world-summary">
    <!-- summary.html will be injected here -->
  </section>
  </main>

  <footer>
    <div class="container">
      <p><a href="https://docs.google.com/spreadsheets/d/1OjpsQEnrNwcXEWYuPskGRA5Jf-U8e_x0x3j2CKJualg/edit?usp=sharing">Settings</a> | <a href="https://github.com/brayvid/based-news">GitHub</a> | <a href="https://blakerayvid.com">Portfolio</a></p>
    </div>
  </footer>

  <!-- Your scripts are unchanged -->
  <script defer>
    document.addEventListener("DOMContentLoaded", function () {
      const digestSliderWrapper = document.getElementById("digest-slider-wrapper");
      const digestSlider = document.getElementById("digest-slider");
      const olderBtn = document.getElementById("older-btn");
      const newerBtn = document.getElementById("newer-btn");
      const dotsContainer = document.getElementById("dots-container");
      const timestampHeader = document.getElementById("digest-timestamp-header");
      const summarySection = document.getElementById("world-summary");

      let manifest = [];
      // currentIndex is the LOGICAL index: 0 is newest, 1 is next newest, etc.
      let currentIndex = 0; 
      let totalItems = 0;
      let touchStartX = 0;
      let touchEndX = 0;
      const swipeThreshold = 50; 

      function updateNavControls() {
        olderBtn.disabled = currentIndex >= totalItems - 1; // At the oldest
        newerBtn.disabled = currentIndex <= 0;             // At the newest
        
        const dots = document.querySelectorAll('.dot');
        dots.forEach((dot) => {
          const dotIndex = parseInt(dot.dataset.logicalIndex);
          dot.classList.toggle('active', dotIndex === currentIndex);
        });
      }

      function updateTimestampHeader() {
        const entry = manifest[currentIndex];
        if (!entry) return;

        // Create a new date object from the timestamp
        const date = new Date(entry.timestamp);
        
        // Round to the nearest hour. Add 30 minutes to handle rounding up/down,
        // then zero out minutes, seconds, and milliseconds.
        date.setMinutes(date.getMinutes() + 30);
        date.setMinutes(0);
        date.setSeconds(0);
        date.setMilliseconds(0);

        // Format the rounded date for display.
        const options = { weekday: 'long', month: 'long', day: 'numeric', hour: 'numeric', timeZoneName: 'short' };
        timestampHeader.textContent = date.toLocaleString(undefined, options);
      }
      
      function adjustWrapperHeight(slide) {
        if (slide) {
          requestAnimationFrame(() => {
            digestSliderWrapper.style.height = `${slide.offsetHeight}px`;
          });
        }
      }

      async function showDigest(index) {
          if (index < 0 || index >= totalItems) return;
          
          currentIndex = index;
          const slideId = `digest-slide-${index}`;
          const slide = document.getElementById(slideId);

          if (!slide) {
              console.error(`Slide container for index ${index} not found!`);
              return;
          }

          // Lazy-load content if the slide is empty
          if (slide.children.length === 0) {
              await loadDigestContent(index, slide);
          }
          
          // Convert logical index to visual index for CSS transform
          const visualIndex = (totalItems - 1) - currentIndex;
          digestSlider.style.transform = `translateX(-${visualIndex * 100}%)`;
          
          updateNavControls();
          updateTimestampHeader();
      }

      async function loadDigestContent(index, slideElement) {
        // CORRECTED: Direct mapping from index to manifest entry
        const entry = manifest[index]; 
        if (!entry || !entry.file) return;

        try {
            const response = await fetch(entry.file);
            if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
            const html = await response.text();
            slideElement.innerHTML = html;
            if (index === currentIndex) {
                adjustWrapperHeight(slideElement);
            }
        } catch (error) {
            slideElement.innerHTML = "<p>Unable to load this digest.</p>";
            console.error(`Could not load content for index ${index}:`, error);
        }
      }
      
      function handleSwipe() {
        const deltaX = touchEndX - touchStartX;
        if (Math.abs(deltaX) > swipeThreshold) {
            if (deltaX < 0) { // Swipe Left: Go Newer
                if (currentIndex > 0) showDigest(currentIndex - 1);
            } else { // Swipe Right: Go Older
                if (currentIndex < totalItems - 1) showDigest(currentIndex + 1);
            }
        }
      }

      // --- EVENT LISTENERS ---
      digestSlider.addEventListener('transitionend', () => {
          adjustWrapperHeight(document.getElementById(`digest-slide-${currentIndex}`));
      });
      digestSliderWrapper.addEventListener('touchstart', e => { touchStartX = e.changedTouches[0].screenX; }, { passive: true });
      digestSliderWrapper.addEventListener('touchend', e => { touchEndX = e.changedTouches[0].screenX; handleSwipe(); });
      window.addEventListener('resize', () => adjustWrapperHeight(document.getElementById(`digest-slide-${currentIndex}`)));

      // --- INITIALIZATION ---
      async function initializeSite() {
          try {
              const manifestRes = await fetch("digest-manifest.json");
              if (!manifestRes.ok) throw new Error("Manifest not found");
              
              manifest = await manifestRes.json();
              // CORRECTED: Total items is now the exact length of the manifest
              totalItems = manifest.length; 
              
              if(totalItems === 0) {
                throw new Error("Manifest is empty. No digests to show.");
              }

              digestSlider.innerHTML = '';
              dotsContainer.innerHTML = '';

              // Create slides and dots in visual order: Oldest (left) to Newest (right)
              for (let visualIndex = 0; visualIndex < totalItems; visualIndex++) {
                  const logicalIndex = (totalItems - 1) - visualIndex;

                  const slide = document.createElement('div');
                  slide.className = 'digest-slide';
                  slide.id = `digest-slide-${logicalIndex}`;
                  digestSlider.appendChild(slide);

                  const dot = document.createElement('div');
                  dot.className = 'dot';
                  dot.dataset.logicalIndex = logicalIndex;
                  dot.onclick = () => showDigest(logicalIndex);
                  
                  // CORRECTED: Get title info directly from manifest
                  const entry = manifest[logicalIndex];
                  const date = new Date(entry.timestamp);
                  dot.title = `Digest from ${date.toLocaleDateString(undefined, { month: 'short', day: 'numeric', hour: 'numeric', minute: '2-digit' })}`;
                  dotsContainer.appendChild(dot); 
              }
              
              olderBtn.onclick = () => { if (currentIndex < totalItems - 1) showDigest(currentIndex + 1); };
              newerBtn.onclick = () => { if (currentIndex > 0) showDigest(currentIndex - 1); };
              
              // Start by showing the latest digest (logical index 0).
              // The showDigest function will automatically trigger content loading.
              await showDigest(0);

          } catch (error) {
              console.error("Initialization failed:", error);
              timestampHeader.textContent = "Could not load headlines";
          }

          fetch("summary.html")
            .then(res => res.text())
            .then(html => {
              const summaryDoc = new DOMParser().parseFromString(html, "text/html");
              summarySection.innerHTML = `<h2 class="summary-heading">Week in Review</h2>${summaryDoc.body.innerHTML}`;
              const lastUpdated = summaryDoc.getElementById("summary-last-updated");
              if (lastUpdated) {
                const stamp = document.createElement("p");
                stamp.className = "timestamp";
                stamp.style.fontSize = "0.9em";
                stamp.style.color = "#666";
                stamp.style.marginTop = "0.5em";
                stamp.textContent = lastUpdated.textContent;
                stamp.style.textAlign = "center";
                document.getElementById("world-summary").appendChild(stamp);
              }
            })
            .catch(() => {
              summarySection.innerHTML = "<p>Unable to load summary.</p>";
            });
      }
      
      initializeSite();
    });
  </script>
<!-- At the end of your index.html <body> -->
<script>
    function loadGtag() {
        const script = document.createElement('script');
        script.async = true;
        script.src = 'https://www.googletagmanager.com/gtag/js?id=G-8LC9EF8GSD';
        document.head.appendChild(script);

        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-8LC9EF8GSD');
    }

    // Load gtag after 3 seconds or on first scroll, whichever comes first
    const timer = setTimeout(loadGtag, 3000);
    window.addEventListener('scroll', () => {
        clearTimeout(timer);
        loadGtag();
    }, { once: true });
</script>
</body>
</html>